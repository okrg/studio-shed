!function(s){"use strict";function r(a,i,o,t){s.ajax({type:"POST",url:bsr_object_vars.endpoint+a,data:{bsr_ajax_nonce:bsr_object_vars.ajax_nonce,action:a,bsr_step:i,bsr_page:o,bsr_data:t},dataType:"json",success:function(i){void 0!==i.message&&(s(".bsr-description").remove(),s(".bsr-progress-wrap").append('<p class="description bsr-description">'+i.message+"</p>")),"done"==i.step?(e("100%"),void 0!==i.next_action?(e("0%",0),r(i.next_action,0,0,i.bsr_data)):(s(".bsr-processing-wrap").remove(),s(".bsr-disabled").removeClass("bsr-disabled button-disabled"),window.location=i.url)):(e(i.percentage),r(a,i.step,i.page,i.bsr_data))}}).fail(function(r){s(".bsr-processing-wrap").remove(),s(".bsr-disabled").removeClass("bsr-disabled button-disabled"),s("#bsr-error-wrap").html('<div class="error"><p>'+bsr_object_vars.unknown+"</p></div>"),window.console&&window.console.log&&console.log(r)})}function e(r,e){void 0===e&&(e=150),s(".bsr-progress").animate({width:r},e)}var a,i,o,t;(a=s("#bsr-backup-submit")).on("click",function(e){if(e.preventDefault(),!a.hasClass("button-disabled")){var i=s(".bsr-action-form").serialize();a.addClass("bsr-disabled button-disabled"),s("#bsr-backup-form").append('<div class="bsr-processing-wrap"><div class="spinner is-active bsr-spinner"></div><div class="bsr-progress-wrap"><div class="bsr-progress"></div></div></div>'),s(".bsr-progress-wrap").append('<p class="description bsr-description">'+bsr_object_vars.processing+"</p>"),r("process_backup",0,0,i)}}),(i=s("#bsr-import-submit")).on("click",function(e){e.preventDefault();var a=s("#bsr-file-import").prop("files")[0],o=s("#bsr_import_profile").val(),t=new FormData;t.append("bsr_import_file",a),t.append("action","upload_import"),t.append("profile",o),t.append("bsr_ajax_nonce",bsr_object_vars.ajax_nonce),s.ajax({url:bsr_object_vars.endpoint+"upload_import",dataType:"json",cache:!1,contentType:!1,processData:!1,data:t,type:"post",success:function(e){"manual"===e.upload_method?confirm("No upload was detected, but an existing backup file was detected at "+e.file+". Do you want to import it?")&&(i.hasClass("button-disabled")||(i.addClass("bsr-disabled button-disabled"),s("#bsr-import-form").append('<div class="bsr-processing-wrap"><div class="spinner is-active bsr-spinner"></div><div class="bsr-progress-wrap"><div class="bsr-progress"></div></div></div>'),s(".bsr-progress-wrap").append('<p class="description bsr-description">Importing database...</p>'),r("process_import",0,0,e))):"ajax"==e.upload_method?i.hasClass("button-disabled")||(i.addClass("bsr-disabled button-disabled"),s("#bsr-import-form").append('<div class="bsr-processing-wrap"><div class="spinner is-active bsr-spinner"></div><div class="bsr-progress-wrap"><div class="bsr-progress"></div></div></div>'),s(".bsr-progress-wrap").append('<p class="description bsr-description">Importing database...</p>'),r("process_import",0,0,e)):alert("Please upload a valid backup file, or try increasing the max upload size.")}}).fail(function(s){window.console&&window.console.log&&console.log(s)})}),o=s("#bsr-submit"),t=s("#bsr-error-wrap"),o.on("click",function(e){if(e.preventDefault(),!o.hasClass("button-disabled"))if(s("#search_for").val())if(s("#bsr-table-select").val()){var a=s(".bsr-action-form").serialize(),i=a.replace(/%5C/g,"#BSR_BACKSLASH#");t.html(""),o.addClass("bsr-disabled button-disabled"),s("#bsr-submit-wrap").append('<div class="bsr-processing-wrap"><div class="spinner is-active bsr-spinner"></div><div class="bsr-progress-wrap"><div class="bsr-progress"></div></div></div>'),s(".bsr-progress-wrap").append('<p class="description bsr-description">'+bsr_object_vars.processing+"</p>"),r("process_search_replace",0,0,i)}else t.html('<div class="error"><p>'+bsr_object_vars.no_tables+"</p></div>");else t.html('<div class="error"><p>'+bsr_object_vars.no_search+"</p></div>")}),s("#bsr-page-size-slider").slider({value:bsr_object_vars.page_size,range:"min",min:1e3,max:5e4,step:1e3,slide:function(r,e){s("#bsr-page-size-value").text(e.value),s("#bsr_page_size").val(e.value)}}),s("#bsr-max-results-slider").slider({value:bsr_object_vars.max_results,range:"min",min:20,max:1e3,step:20,slide:function(r,e){s("#bsr-max-results-value").text(e.value),s("#bsr_max_results").val(e.value)}}),s("#save_profile").on("change",function(){this.checked?s(this).closest("tr").next("tr").fadeIn("fast"):s(this).closest("tr").next("tr").fadeOut("fast")})}(jQuery);